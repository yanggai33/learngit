<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="favicon.ico" >
<link rel="Shortcut Icon" href="favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="style/lib/html5.js"></script>
<script type="text/javascript" src="style/lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="style/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="style/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/css/style.css" />
<link rel="stylesheet" type="text/css" href="style/main.css" />
<style type="text/css">
    #search-result{
        display: none;
        position: absolute;
        top: 30px;
        left: 15px;
        width: 400px;
        background-color: #eee;
        z-index: 99;
    }
    #search-result li:hover{
        background-color: #a9a9a9;
    }
    #search-result li{
        line-height: 30px;
    }
</style>
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
<!--/meta 作为公共模版分离出去-->

<title>新增汽车产品</title>

</head>
<body>
<!--_header 作为公共模版分离出去-->

<!--/_header 作为公共模版分离出去-->

<!--_menu 作为公共模版分离出去-->
<div class="Hui-article-box">
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 主页 <span class="c-gray en">&gt;</span> 电动乘用车 <span class="c-gray en">&gt;</span> 添加产品 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	<div>
		<div id="tab_product" class="HuiTab">
			<div class="tabBar clearfix">
				<span>基本信息</span>
				<span>产品详情</span>
				<span>新闻资讯</span>
			</div>
			<div class="tabCon">
				<iframe name="demoIframe" style="display:none"  id="frame1"></iframe>
				<form action="b_car_add" method="post" class="form form-horizontal" id="productAddForm" enctype="multipart/form-data" target="demoIframe">
					<div class="row cl skin-minimal">
						<div class="radio-box col-sm-offset-2">
							<input type="radio" id="radio-1" value="1" name="car.marketed" checked>
							<label for="radio-1">已上市</label>
						</div>
						<div class="radio-box">
							<input type="radio" id="radio-2" value="0" name="car.marketed">
							<label for="radio-2">未上市</label>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品标题：</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" value="" placeholder="请输入产品标题" id="product_title" name="car.name">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">产品描述</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" value="" placeholder="请输入产品描述" id="product_info" name="car.brief">
						</div>
					</div>
			        <div class="row cl">
			            <label class="form-label col-xs-4 col-sm-2">生产企业：</label>
			            <div style="position: relative;" class="formControls col-xs-8 col-sm-9">
			                <input type="text" class="input-text" value="" placeholder="" id="choose-company" autocomplete="off" >
			                <input type="hidden" value="" id="companyId" name="car.company.id">
			                <div id="search-result">
			                </div>
			            </div>
			        </div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>品牌</label>
						<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
							<select id="brand" name="car.brand.id" class="select" >
							</select>
							</span>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">联系人</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" placeholder="" id="contact" name="car.charge">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">联系方式</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" placeholder="" id="contact_method" name="car.tel">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">联系QQ</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" placeholder="" id="contact_qq" name="car.qq">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">企业地址</label>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" class="input-text" placeholder="" id="address" name="car.address">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>分类</label>
						<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
							<select name="car.category.id" class="select" >
								<option value="3">电动乘用车</option>
								<option value="4">电动客车</option>
								<option value="5">微型电动车</option>
							</select>
							</span>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品类型</label>
						<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
							<select name="car.energy_type" class="select" >
								<option value="低速电动车">低速电动车</option>
								<option value="纯电动">纯电动</option>
								<option value="插电式">插电式</option>
								<option value="增程式">增程式</option>
								<option value="混合动力">混合动力</option>
								<option value="燃料电池">燃料电池</option>
							</select>
							</span>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>车型级别</label>
						<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
							<select id="type_grade" name="car.level" class="select" >
								<option value="微型">微型</option>
								<option value="小型">小型</option>
								<option value="紧凑型">紧凑型</option>
								<option value="中型">中型</option>
								<option value="中大型">中大型</option>
								<option value="豪华型">豪华型</option>
								<option value="SUV">SUV</option>
								<option value="MPV">MPV</option>
								<option value="跑车">跑车</option>
								<option value="商用">商用</option>
								
							</select>
							</span>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>生产状态</label>
						<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
							<select id="product_state" name="car.product_state" class="select" >
								<option >在产在售</option>
								<option >停产在售</option>
								<option >在产停售</option>
								<option >停产停售</option>
							</select>
							</span>
						</div>
					</div>
					<div class="row cl">
						<div id="car-color" class="col-sm-offset-2 col-sm-9">
						</div>
						<label class="form-label col-xs-3 col-sm-2">车型颜色</label>
						<div class="formControls col-xs-3 col-sm-3">
							<input type="text" class="input-text" value="" placeholder="请输入颜色名称" id="color-name">
						</div>
						<div id="saveColor" class="formControls col-xs-3 col-sm-3">
							<input type="text" class="input-text" value="" placeholder="请输入颜色值" id="color-value" >
						</div>
						<div class="formControls col-xs-3 col-sm-3">
							<a href="javascript:" onClick="addColor();" class="btn btn-primary">+ 添加颜色</a>
						</div>
					</div>
			        <div class="row cl">
			            <label class="form-label col-xs-4 col-sm-2">图片上传：</label>
			            <div class="formControls col-xs-8 col-sm-9">
			                <input type="file" multiple="true" value="" placeholder="" id="" name="pic">
			            </div>
			        </div>
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2">产品型号</label>
						<div class="formControls col-xs-8 col-sm-9">
							<!-- <input type="text" class="input-text col-sm-2" placeholder="请输入产品型号名" id="product_number" name="product_number"> -->
							<a onClick="product_edit('添加车型','b-car-config','10001')" href="#" type="button" class="btn btn-primary">+ 添加车型</a>
						</div>
					</div>
					<div class="row cl">
						<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
							<button onClick="checkState(event);" class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存信息</button>
							<a href="#" id="reset" class="btn btn-secondary radius"><i class="Hui-iconfont">&#xe632;</i> 重置</a>
						</div>
					</div>
				</form>
			</div>
			<div class="tabCon">
				<form action="b_car_addDetail" method="post" class="form form-horizontal" id="cardetailForm" enctype="multipart/form-data">
					<div class="row cl">
						<label class="form-label col-xs-4 col-sm-2"></label>
						<div class="formControls col-xs-8 col-sm-9"> 
							<script id="editor" type="text/plain" style="width:100%;height:400px;" name="car.detail"></script> 
						</div>
					</div>
					<div class="row cl">
						<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
							<button class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存信息</button>
							<a href="#" id="reset" class="btn btn-secondary radius"><i class="Hui-iconfont">&#xe632;</i> 重置</a>
						</div>
					</div>
				</form>
			</div>
			<!--<div class="tabCon">
		            <div>
						<div class="pd-20">
							<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a class="btn btn-primary radius"  href="b-news-release"> 发布新闻</a><a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> </span> <span class="r">共有数据：<strong></strong> 条</span> </div>
							<div class="mt-20">
								<table class="table table-border table-bordered table-bg table-hover table-sort">
									<thead>
										<tr class="text-c">
											<th width="40"><input name="" type="checkbox" value="">选择</th>
											<th width="100">新闻标题</th>
											<th width="30">点击量</th>
											<th width="30">显示</th>
											<th width="100">上传时间</th>
											<th width="140">操作</th>
										</tr>
									</thead>
									<tbody>
										<tr class="text-c va-m">
											<td><input name="" type="checkbox" value=""></td>
											<td><a style="text-decoration:none" href="javascript:;">志道集团创世360新品发布，敬请期待！</a></td>
											<td>25</td>
											<td class="td-status"><a onclick="toggleState(this)" href="#" class="toggle btn btn-danger">否</a></td>
											<td class="td-time"><span>2016-10-15</span></td>
											<td class="td-manage"><a style="text-decoration:none" class="ml-5" onClick="product_del(this,'10001')" href="javascript:;" title="删除">【删除】</a> </td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
		            </div>
			</div>-->
		</div>
	</div>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="style/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="style/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="style/static/h-ui/js/H-ui.js"></script> 
<script type="text/javascript" src="style/static/h-ui.admin/js/H-ui.admin.page.js"></script>
<script type="text/javascript" src="style/lib/mustache.js"></script> 
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="style/lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="style/lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="style/lib/jquery.validation/1.14.0/messages_zh.js"></script> 
<script type="text/javascript" src="ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" src="ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" src="style/lib/fileUpload.js"></script>
<script type="text/javascript">
$().ready(function(){
	$('#productAddForm').validate({
		rules:{
			"car.name":{
				required:true,
				maxlength:60
			},
			"car.brief":{maxlength:255},
			"car.charge":{maxlength:20},
			"car.tel":{maxlength:30},
			"car.qq":{maxlength:20},
			"car.address":{maxlength:255}
			
		},
		messages:{
			"car.name":{maxlength:'长度不能超过60个字符'},
			"car.brief":{maxlength:'长度不能超过255个字符'},
			"car.charge":{maxlength:'长度不能超过20个字符'},
			"car.tel":{maxlength:'长度不能超过30个字符'},
			"car.qq":{maxlength:'长度不能超过20个字符'},
			"car.address":{maxlength:'长度不能超过255个字符'},
		}
	})
})
	
$().ready(function() {
    var validator = $("#productAddForm").validate();
    $("#reset").click(function() {
        validator.resetForm();
    });
});
    $('#frame1').on('load', function() {
              var responseText = $('iframe')[0].contentDocument.body.textContent; 
              var responseData = JSON.parse(responseText) || {};
              console.log(responseData);
                if (responseData.response.msg.success == true || responseData.code == 200) { 
              	     alert('表单提交成功');
              	} else { 
              		alert('表单提交失败');
              	} 
            });
    $('#cardetailForm').submit(function(event){
	     event.preventDefault();
	     var form = $(this);
			$.ajax({
				type : 'post',
				async: false,
				url : form.attr("action"),
				data: form.serialize(),
				success : function(data){
					console.log(data);
					var res = data.response;
					if(res.msg.success == true){
						alert('表单提交成功');
					}else{
						alert('表单提交失败');
					}
				}
			});
    });
  
$(function(){
    $.ajax({
        url: 'ev/brand_listAll',
        type: 'POST',
        dataType: 'json'
    })
    .done(function(data) {
        var resData = data.response.data;
        var resTpl = '{{#Brands}}<option value="{{id}}">{{brand}}</option>{{/Brands}}';
        var resHtml = Mustache.render(resTpl, resData);
        var brand = $('#brand');
        brand.html( resHtml );
    })
    .fail(function() {
        // console.log("error");
    })
    .always(function() {
        // console.log("complete");
    });




	var lastTime = 0;
	$('#choose-company').bind('input',function(){
			var now = new Date().getTime();
			var interval = now - lastTime;
			if (interval > 2000) {
				lastTime = now;
			    $('#companyId').val('');
			    var text = $(this).val();
			    $.ajax({
			        url: 'ev/company_findByName',
			        type: 'POST',
			        dataType: 'json',
			        data: {'company.name': text}
			    })
			    .done(function(data){
			        console.log(data);
			        var resData = data.response.data;
			        var resTpl = '<ul>{{#Companys}}<li data-value="{{id}}">{{name}}</li>{{/Companys}}</ul>';
			        var resHtml = Mustache.render(resTpl, resData);
			        var result = $('#search-result');
			        result.html( resHtml );
			    })
			}
	})

    
})



$('#search-result').delegate('li','click',function(){
    var value = $(this).html();
    var dataValue = $(this).attr('data-value');
    $('#choose-company').val(value);
    $('#companyId').attr('value',dataValue);
})
$('#choose-company').click(function(event){
    event.stopPropagation();
    $('#search-result').show();
});
$(document).click(function(){
    $('#search-result').hide();
});

function checkState(event){
	var value = $('input[type="hidden"]').val();
	if (!value) {
		event.preventDefault();
		alert('请在生产企业的下拉列表中选择企业');
	}
}






function product_edit(title,url,id){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
$(function(){
	$.Huitab("#tab_product .tabBar span","#tab_product .tabCon","current","click","0");
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
	
	$list = $("#fileList"),
	$btn = $("#btn-star"),
	state = "pending"

});


$(function(){
	var ue = UE.getEditor('editor');
});
function addColor(){
	var colorName = $('#color-name').val();
	var colorValue = $('#color-value').val();
	var carColor = $('#car-color');
	var saveColor = $('#saveColor');
	var colorMsg = $('<span class="color-show" style="background-color:#'+colorValue+';"></span><span class="color-name">'+colorName+'</span>');
	var namesInput = $('<input type="hidden" name="colors" value="'+colorValue+'"/>');
	var colorsInput = $('<input type="hidden" name="color_names" value="'+colorName+'"/>');
	namesInput.appendTo(saveColor);
	colorsInput.appendTo(saveColor);
	colorMsg.appendTo(carColor);
}

</script>
</body>
</html>


