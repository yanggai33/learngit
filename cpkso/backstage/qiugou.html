<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta HTTP-EQUIV="pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<meta HTTP-EQUIV="expires" CONTENT="0">
<link rel="Bookmark" href="favicon.ico" >
<link rel="Shortcut Icon" href="favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="style/lib/html5.js"></script>
<script type="text/javascript" src="style/lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="style/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="style/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="style/static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
<!--/meta 作为公共模版分离出去-->

<title>主页-求购信息</title>
<link rel="stylesheet" href="style/lib/zTree/v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
</head>
<body>
<!--_header 作为公共模版分离出去-->

<!--/_header 作为公共模版分离出去-->
<!--_menu 作为公共模版分离出去-->
<!--/_menu 作为公共模版分离出去-->

<section class="Hui-article-box">
	<img src="style/static/h-ui.admin/images/search-logo.png" class="img-responsive" style="padding:10px 0;">
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 主页 <span class="c-gray en">&gt; 求购信息<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	<div class="Hui-article" style="margin-top:60px;">
		<div>
			<div class="pd-20">
				<!--求购标题
				<input type="text" width="200">
				编号：
				<input type="text" width="100">
				<input type="button" value="搜索" class="search">
				<input type="button" value="重置" class="reset"><br>-->
					<div class="category">
					企业分类
					
						<select class="form-control"  id="s_main"  name="s_main"></select>
					
				&nbsp;&nbsp;-
				
						<select class="form-control"   id="s_sub"  name="s_sub"></select>													</select>
					&nbsp;&nbsp;-
				       <select class="form-control"  id="s_last"  name="s_last"></select>
						<!--求购状态
						<select class="form-control">
							<option>已截至</option>
						</select>-->
						所在省份
						<select class="form-control">
							<option>河南省</option>
							<option>河北省</option>
						</select>
					</div>
				
				
				
				<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> <a class="btn btn-primary radius" onclick="product_add('添加求购信息','b-qiugou-add')" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 添加求购信息</a></span> <span class="r">共有数据：<strong></strong> 条</span> </div>
				<div class="mt-20">
					<table class="table table-border  table-bg table-hover table-sort">
						<thead>
							<tr class="text-c">
								<th width="50">选择<input name="" type="checkbox" value=""></th>
								<th width="100">编号</th>
								<th width="120">标题名</th>
								<th width="40">点击量</th>
								<th width="40">回复量</th>
								<th width="40">招标</th>
								<th width="40">审核</th>
								<th width="70">发布时间</th>
								<th width="80">截止时间</th>
								<th width="100">操作</th>
							</tr>
						</thead>
						<tbody  id="qlist">
						</tbody>
					</table>
				</div>
			</div>
		</div>
    </div>
</section>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="style/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="style/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="style/static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="style/static/h-ui.admin/js/H-ui.admin.page.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="style/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="style/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="style/lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" class="resources library" src="style/lib/cate.js"></script>
    <script > _init_area();</script>
    <div id="show"></div>
<script type="text/javascript">

// $('.table-sort').dataTable({
// 	"aaSorting": [[ 1, "desc" ]],//默认第几个排序
// 	"bStateSave": true,//状态保存
// 	"aoColumnDefs": [
// 	  {"orderable":false,"aTargets":[0,7]}// 制定列不参与排序
// 	]
// });
/*图片-添加*/
function product_add(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*图片-查看*/
function product_show(title,url,id){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*图片-审核*/
function product_shenhe(obj,id){
	layer.confirm('审核文章？', {
		btn: ['通过','不通过'],
		shade: false
	},
	function(){
		$(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="product_start(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
		$(obj).remove();
		layer.msg('已发布', {icon:6,time:1000});
	},
	function(){
		$(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="product_shenqing(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-danger radius">未通过</span>');
		$(obj).remove();
    	layer.msg('未通过', {icon:5,time:1000});
	});
}
/*图片-下架*/
function product_stop(obj,id){
	layer.confirm('确认要下架吗？',function(index){
		$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="product_start(this,id)" href="javascript:;" title="发布"><i class="Hui-iconfont">&#xe603;</i></a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已下架</span>');
		$(obj).remove();
		layer.msg('已下架!',{icon: 5,time:1000});
	});
}

/*图片-发布*/
function product_start(obj,id){
	layer.confirm('确认要发布吗？',function(index){
		$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="product_stop(this,id)" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
		$(obj).remove();
		layer.msg('已发布!',{icon: 6,time:1000});
	});
}
/*图片-申请上线*/
function product_shenqing(obj,id){
	$(obj).parents("tr").find(".td-status").html('<span class="label label-default radius">待审核</span>');
	$(obj).parents("tr").find(".td-manage").html("");
	layer.msg('已提交申请，耐心等待审核!', {icon: 1,time:2000});
}
/*图片-编辑*/
function product_edit(title,url,id){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
/*图片-删除*/
function product_del(obj,id){
	layer.confirm('确认要删除吗？',function(index){
		$(obj).parents("tr").remove();
		layer.msg('已删除!',{icon:1,time:1000});
	});
}


 function brand_add(title,url){
	var index = layer.open({
		type: 2,
		title: title,
		content: url
	});
	layer.full(index);
}
//上传弹窗
$('.td-manage .upload').on('click',function(){
	$('.box1').show();
	$('.cover').show();
})
//续期弹窗
$('.td-manage .longdate').click(function(){
	$('.box_duration').show();
	$('.cover').show();
})

$('.box1 .back').click(function(){
	$('.box1').hide();
	$('.cover').hide();
})

$('.box_duration .back1').click(function(){
	$('.box_duration').hide();
	$('.cover').hide();
})

var  gtid=document.getElementById('display');
var showMenu=function(){
	gtid('display').innerHTML = "<h3>" + gtid('s_main').value  + 	
	gtid('s_sub').value  + 
	gtid('s_last').value + "</h3>"
	gtid('s_last').setAttribute('onchange','showMenu()');
}

    function  toggleState(el){
    	var str=$(el).html();
    	if (str === '是') {
    		$(el).html('否');
    	} else {
    		$(el).html('是');
    	}
    }
//删除求购信息
function require_del(obj,id){
	var url = 'b_require_del?require.id=' + id;
	layer.confirm('确认要删除吗？',function(index){
		$.ajax({
			type: 'POST',
			url: url,
			dataType: 'json',
		})
		.done(function(data) {
			$(obj).parents("tr").remove();
			layer.msg('已删除!',{icon:1,time:1000});
		})
		.fail(function(data) {
		console.log(error);
		});
	});
}

$(document).ready(function(){
	$.ajax({
		type:"post",
		url:"b_require_listB",
	})
	.done(function(data){
		tplRender(data);
		$('.table-sort').dataTable({
			"aaSorting": [[ 1, "desc" ]],//默认第几个排序
			"bStateSave": true,//状态保存
			"pageLength": 20,
			"info": false,
			"aoColumnDefs": [
			  // {"orderable":false,"aTargets":[0,4]}// 制定列不参与排序
			],
			"pagingType": "simple",
			"lengthChange": false,
			"searching": false
		});
		$('#DataTables_Table_0_next').bind('click',function(){
			$.ajax({
				type:"post",
				url:"b_require_nextPage",
				dataType:'json',
				cache: false
			})
		    .done(function(data){
		    	tplRender(data);
		    })
		    .fail(function(data){
		    	console.log(error);
		    });
		});
  		$('#DataTables_Table_0_previous').bind('click',function(){
			$.ajax({
				type:"post",
				url:"b_require_prevPage",
				dataType:'json',
				cache: false
			})
		    .done(function(data){
		    	tplRender(data);
		    })
		    .fail(function(data){
		    	console.log(error);
		    });
		});
	})
	function tplRender(data){
		var data = data.response.data;
		console.log(data);
		var accad='{{#Requires}}<tr class="text-c va-m"><td><input name="" type="checkbox" value=""></td><td>{{id}}</td><td><a onClick="" href="javascript:;" class="buylocation">{{title}}</a></td><td>{{hit}}</td><td>{{reply}}</td><td class="td-status" ><button data-id="{{id}}" class="tender">{{^tender}}否{{/tender}}{{#tender}}是{{/tender}}</button></td><td class="td-status"><button data-id="{{id}}" class="isvalid">{{^valid}}否{{/valid}}{{#valid}}是{{/valid}}</button></td><td >{{publish_time}}</td><td >{{expire_date}}</td><td><a style="text-decoration:none" >【修改】</a><a style="text-decoration:none" onclick="require_del(this,{{id}})">【删除】</a></td></tr>{{/Requires}}';
		var acceptcontent=Mustache.render(accad,data);
		var qlist=$('#qlist');
		qlist.html(acceptcontent);
		$('#qlist .tender').click(function() {
			var $this = $(this);
			var id = $(this).attr('data-id');
			var url = 'b_require_tender?require.id=' + id;
			$.ajax({
				url: url,
				type: 'GET',
			})
			.done(function(data) {
				if (data.response.msg.success) {
					toggleState($this);
				} else {
					alert('请重试！')
				}

			})
		})
		
		
		$('#qlist .isvalid').click(function() {
			var $this = $(this);
			var id = $(this).attr('data-id');
			var url = 'b_require_verify?require.id=' + id;
			console.log(url);
			$.ajax({
				url: url,
				type: 'GET',
			})
			.done(function(data) {
				console.log(data);
				if (data.response.msg.success) {
					toggleState($this);
				} else {
					alert('请重试！')
				}

			})
		})
	}
	// 	success:function(backData, textStatus, ajax) {
	// 	 	    	//alert(2);
	// 	 	    	var res = backData.response;
	// 	 	    	console.log(res);
		 	    	
	// 	 	    	var $qlist = $("#qlist");
	// 	 	    	var l = res.data.Partss;
	// 	 	    	for(var i=0;i<l.length;i++){
	// 	 	    	$qlist.html('<tr class="text-c va-m"><td>'+'<input name="checks" type="checkbox"  id="checks">'+'</td><td>'+l[i].id+'</td><td>'+l[i].title+'</td><td>'+l[i].hit+'</td><td>'+l[i].reply+
	// 	 	    	'</td><td>'+'<a onclick="toggleState(this)" href="require_tender?require.id=l[i].id" class="toggle btn btn-danger">l[i].tender==1?"是":"否"</a>'+'</td><td>'+'<a onclick="toggleState(this)" href="require_verify?require.id=l[i].id" class="toggle btn btn-danger">l[i].valid==1?"是":"否"</a>'
	// 	 	    	+'</td><td>'+l[i].publish_time+'</td></td>'+l[i].expire_date+'</td><td class="td-manage">'+'<a style="text-decoration:none" class="ml-5" href="car-add.html?id=1" title="编辑">【编辑】</a><a style="text-decoration:none" onClick="" href="company-news.html?id=1" title="新闻">【新闻】</a> <a style="text-decoration:none" class="ml-5" onClick="product_del(this)" href="javascript:;" title="删除">【删除】</a>'+'</td></tr>');
	// 	 	    	}
		 	    	
	// 	 	    }
	// })
})
</script>
<script type="text/javascript"  src="style/lib/mustache.js"></script>

</body>
</html>